{% extends 'base.html' %}
{% load static %}

{% block title %}Criando Plano{% endblock %}

{% block header %}
<meta http-equiv="refresh" content="184; URL={% url 'avaliacao' %}" />
<link rel="stylesheet" href="{% static 'core/css/dashboard.css' %}" />
<style>
  :root{
    /* Mantener todo sincronizado con el refresh */
    --dur-total: 184s;
  }

  /* Contenedor principal sin fondos, listo para superponer imágenes después */
  .wizard-wrap{
    min-height: 70vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 24px;
  }

  /* Barra de progreso */
  .progress{
    height: 5vh;
    background-color: #777;
    position: relative;
    border-radius: .5rem;
    overflow: hidden;
  }
  .progress .progress-bar{
    position: absolute;
    inset: 0 auto 0 0;
    height: 100%;
    background-color: #2b6ca3;
    color: #fff;
    font-weight: 700;
    display: flex;
    align-items: center;
    justify-content: center;
    white-space: nowrap;
    animation: progress-animation var(--dur-total) linear forwards;
  }
  @keyframes progress-animation{
    from{ width: 0%; }
    to  { width: 100%; }
  }

  /* Frases que aparecen de a una */
  .steps{
    position: relative;
    min-height: 160px; /* espacio para que no salte el layout */
  }
  .steps p{
    position: absolute;
    inset: 0;
    margin: auto;
    max-width: 900px;
    padding: 0 16px;
    text-align: center;
    font-size: 21px;
    opacity: 0;
    animation: fadein 8s linear forwards; /* cada una se hace visible y se oculta sola */
  }

  /* Accesibilidad: reduce motion */
  @media (prefers-reduced-motion: reduce){
    .progress .progress-bar{ animation: none; width: 100%; }
    .steps p{ animation: none; opacity: 1; position: static; margin: 8px auto; }
  }

  /* Aparición/desaparición suave de cada mensaje */
  @keyframes fadein{
    0%,100%{ opacity: 0; }
    10%,90%{ opacity: 1; }
  }

  /* Botón final */
  .btn-quest{
    background-color: #ED7D31;
    font-weight: 900;
    color: #fff;
    margin: 32px auto 0;
    opacity: 0;
    pointer-events: none;
    transition: .2s ease-in-out;
    animation: show-btn .1s linear calc(var(--dur-total) + 1s) forwards; /* aparece al final */
  }
  .btn-quest:hover{
    background-color: #ED7D31;
    color: #fff;
    border: 1px solid #fff;
    box-shadow: 0 0 5px #fff;
  }
  @keyframes show-btn{
    to{ opacity: 1; pointer-events: auto; }
  }

  /* Delays de cada frase (repartidos a lo largo de 184s) */
  /* Ajustá tiempos si querés más/menos pausa entre frases */
  #primeira{  animation-delay:   0s; }
  #segunda{   animation-delay:   7s; }
  #terceira{  animation-delay:  16s; }
  #quarta{    animation-delay:  25s; }
  #quinta{    animation-delay:  34s; }
  #sexta{     animation-delay:  43s; }
  #setima{    animation-delay:  52s; }
  #oitava{    animation-delay:  61s; }
  #nona{      animation-delay:  70s; }
  #decima{    animation-delay:  79s; }
  #dprimeira{ animation-delay:  88s; }
  #dsegunda{  animation-delay:  97s; }
  #dterceira{ animation-delay: 106s; }
  #dquarta{   animation-delay: 115s; }
  #dquinta{   animation-delay: 124s; }
  #dsexta{    animation-delay: 133s; }
  #dsetima{   animation-delay: 142s; }
  #doitava{   animation-delay: 151s; }
  #dnona{     animation-delay: 160s; }  /* corregido id duplicado */
  #ddecima{   animation-delay: 169s; }  /* nuevo id para evitar duplicados */
  #vigessima{ animation-delay: 178s; }  /* aparece justo antes del final */
</style>
{% endblock %}

{% block conteudo %}
<div class="container wizard-wrap">
  <!-- PROGRESS -->
  <div class="progress">
    {% if exercicios.treino != '0' %}
      <div class="progress-bar">Criando seus Planos Alimentares Personalizados</div>
    {% else %}
      <div class="progress-bar">Criando seu Plano Alimentar Personalizado</div>
    {% endif %}
  </div>

  <!-- FRASES -->
  <div class="steps">
    <p id="primeira">Muito bem, {{ dados_pessoais.user }}</p>
    <p id="segunda">Vamos começar a montar seus Planos Alimentares!</p>
    <p id="terceira">Você me disse que seu peso é de {{ antropometricos.peso }} Kg.</p>
    <p id="quarta">Sua altura é de {{ dados_pessoais.altura }} cm.</p>
    <p id="quinta">Opa, cheguei ao seu % de gordura com as medidas que você me passou.</p>

    {% if exercicios.treino != '0' %}
      <p id="sexta">Você me disse que faz exercício: {{ exercicios.tempo_exercicio }} minutos. Ótimo!</p>
    {% else %}
      <p id="sexta">Você me disse que não pratica exercícios. Entendido!</p>
    {% endif %}

    <p id="setima">Agora cheguei às calorias que você precisa comer para emagrecer ou definir, sem passar fome e sem
      restrições desnecessárias!</p>
    <p id="oitava">Vou construir seus planos levando em conta sua “Real Composição Corporal”.</p>
    <p id="nona">Você tem ideia da importância disso? Isso permite uma super personalização das calorias que você precisa comer.</p>

    <p id="decima">Você vai Acordar às {{ horarios.acordar }}h ...</p>
    <p id="dprimeira">Vai tomar o Café da Manhã às {{ horarios.cafe_da_manha }}h ...</p>
    <p id="dsegunda">Vai treinar às {{ horarios.treino }}h ...</p>
    <p id="dterceira">Pronto!</p>

    {% if exercicios.treino == '0' %}
      <p id="dquarta">Montei 1 Plano Alimentar para você, {{ dados_pessoais.user }}.</p>
      <p id="dquinta">Um Plano alimentar SEM TREINO.</p>
      <p id="dsexta">É isso aí! Um plano que vai te ajudar em todos os dias da sua semana.</p>
    {% else %}
      <p id="dquarta">Montei 2 Planos Alimentares para você, {{ dados_pessoais.user }}.</p>
      <p id="dquinta">Um Plano para dia COM TREINO e outro para dia SEM TREINO.</p>
      <p id="dsexta">É isso aí! São 2 planos que vão te ajudar em todos os dias da sua semana.</p>
    {% endif %}

    <p id="dsetima">Para informações complementares (ex.: como fazer pra comer pizza?)</p>
    <p id="doitava">Consulte o Material de Apoio.</p>
    <p id="dnona">Se tiver alguma dúvida, me escreva pelo WhatsApp ou Email.</p>
    <p id="ddecima">Preparando tudo...</p>

    {% if exercicios.treino != '0' %}
      <p id="vigessima">Vamos ver os seus planos?</p>
    {% else %}
      <p id="vigessima">Vamos ver o seu plano?</p>
    {% endif %}
  </div>

  <!-- BOTÓN FINAL (aparece solo al final) -->
  <a class="btn btn-quest btn btn-lg px-4" href="{% url 'avaliacao' %}">Visualizar Plano Alimentar</a>
</div>

{% include "parciais/_footer.html" %}
{% endblock %}
